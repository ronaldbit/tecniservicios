<!doctype html><html><head><meta charset="utf-8"><title>Admin Productos</title>
<link rel="stylesheet" href="/assets/style.css"></head><body>
<div class="container">
  <h2>Productos (Admin)</h2>
  <div style="display:flex;gap:8px;margin-bottom:12px">
    <input id="codigo" placeholder="Código"/>
    <input id="nombre" placeholder="Nombre"/>
    <input id="precio" type="number" step="0.01" placeholder="Precio"/>
    <label><input id="pub" type="checkbox"/> Publicar</label>
    <button onclick="create()">Crear</button>
  </div>
  <table class="table" id="tbl"><thead><tr><th>ID</th><th>Código</th><th>Nombre</th><th>Precio</th><th>Publicado</th><th></th></tr></thead><tbody></tbody></table>
</div>
<script>
async function fetchJSON(u,opts){const r=await fetch(u,opts||{});if(!r.ok)throw new Error('HTTP '+r.status);return r.json();}
async function reload(){
  const rows = await fetchJSON('/api/tienda/products');
  tbl.querySelector('tbody').innerHTML = rows.map(p=>`<tr>
    <td>${p.id}</td><td>${p.codigo||''}</td><td>${p.nombre}</td><td>S/ ${(p.precio||0).toFixed(2)}</td><td>${p.publicarOnline?'Sí':'No'}</td>
    <td><button onclick="del(${p.id})">Eliminar</button></td>
  </tr>`).join('');
}
async function create(){
  const body = {codigo: codigo.value, nombre: nombre.value, precio: parseFloat(precio.value||'0'), publicarOnline: pub.checked};
  const r = await fetch('/api/admin/products', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(body)});
  if(r.ok){ codigo.value=nombre.value=precio.value=''; pub.checked=false; reload(); } else alert('Error');
}
async function del(id){
  if(!confirm('Eliminar '+id+'?')) return;
  await fetch('/api/admin/products/'+id, {method:'DELETE'});
  reload();
}
reload();
</script>
</body></html>
