<div
  class="pc-container"
  th:replace="~{dashboard/layout :: layout(~{::content}, ${usuario}, 'Inicio', '/dashboard')}"
>
  <div class="pc-content" th:fragment="content">
    <div class="row">
      <div class="col-12">
        <div class="card welcome-banner bg-blue-800">
          <div class="card-body">
            <div class="row">
              <div class="col-sm-6">
                <div class="p-4">
                  <h2 class="text-white">Panel de Ventas</h2>
                  <p class="text-white">
                    Monitorea ingresos y pedidos en tiempo real.
                  </p>
                  <a
                    th:href="@{/dashboard/ventas/venta-normal}"
                    class="btn btn-outline-light"
                    >+ Nueva venta</a
                  >
                </div>
              </div>
              <div class="col-sm-6 text-center">
                <div class="img-welcome-banner">
                  <img
                    src="/assets/images/widget/welcome-banner.png"
                    alt="img"
                    class="img-fluid"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xxl-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="avtar avtar-s bg-light-primary">
                  <i class="ti ti-currency-dollar f-20 text-primary"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <h6 class="mb-0">Ingresos de hoy</h6>
              </div>
            </div>
            <div class="bg-body p-3 mt-3 rounded">
              <div class="mt-3 row align-items-center">
                <div class="col-12">
                  <h5
                    class="mb-1"
                    th:text="'S/ ' + ${#numbers.formatDecimal(kpi.ingresosHoy, 1, 2)}"
                  >
                    S/ 0.00
                  </h5>
                  <p class="text-primary mb-0">
                    <span th:text="${kpi.crecimientoIngresos}">+0%</span> vs
                    ayer
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xxl-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="avtar avtar-s bg-light-success">
                  <i class="ti ti-truck f-20 text-success"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <h6 class="mb-0">Pedidos Proveedor</h6>
              </div>
            </div>
            <div class="bg-body p-3 mt-3 rounded">
              <div class="mt-3 row align-items-center">
                <div class="col-12">
                  <h5 class="mb-1" th:text="${kpi.ordenesPendientes}">0</h5>
                  <p class="text-success mb-0">Pendientes de entrega</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xxl-3">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="avtar avtar-s bg-light-danger">
                  <i class="ti ti-alert-circle f-20 text-danger"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <h6 class="mb-0">Devoluciones (Mes)</h6>
              </div>
            </div>
            <div class="bg-body p-3 mt-3 rounded">
              <div class="mt-3 row align-items-center">
                <div class="col-12">
                  <h5 class="mb-1" th:text="${kpi.devolucionesMes}">0</h5>
                  <p class="text-danger mb-0">Ventas anuladas</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <h5 class="mb-0">Ventas del Año</h5>
            </div>
            <div id="customer-rate-graph"></div>
          </div>
        </div>
      </div>

      <div hidden>
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <h5 class="mb-0">Canales de Venta</h5>
            </div>
            <div id="total-income-graph"></div>

            <div class="row g-3 mt-3">
              <div class="col-6">
                <div class="bg-body p-2 rounded">
                  <p class="mb-0 text-primary fw-bold">Física</p>
                  <h6
                    th:text="'S/ ' + ${#numbers.formatDecimal(pieFisica, 1, 2)}"
                  >
                    0.00
                  </h6>
                </div>
              </div>
              <div class="col-6">
                <div class="bg-body p-2 rounded">
                  <p class="mb-0 text-warning fw-bold">Online</p>
                  <h6
                    th:text="'S/ ' + ${#numbers.formatDecimal(pieOnline, 1, 2)}"
                  >
                    0.00
                  </h6>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script th:inline="javascript">
  document.addEventListener("DOMContentLoaded", function () {
    setTimeout(function () {
      var datosAnuales = /*[[${graficoAnual}]]*/ [
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      ];

      var optionsArea = {
        chart: { type: "area", height: 230, toolbar: { show: false } },
        colors: ["#0d6efd"],
        fill: {
          type: "gradient",
          gradient: { shadeIntensity: 1, opacityFrom: 0.5, opacityTo: 0 },
        },
        dataLabels: { enabled: false },
        stroke: { width: 2, curve: "smooth" },
        series: [{ name: "Ventas", data: datosAnuales }],
        xaxis: {
          categories: [
            "Ene",
            "Feb",
            "Mar",
            "Abr",
            "May",
            "Jun",
            "Jul",
            "Ago",
            "Sep",
            "Oct",
            "Nov",
            "Dic",
          ],
        },
        yaxis: {
          labels: {
            formatter: function (value) {
              return "S/ " + value;
            },
          },
        },
      };
      new ApexCharts(
        document.querySelector("#customer-rate-graph"),
        optionsArea
      ).render();

      var valFisica = /*[[${pieFisica}]]*/ 0;
      var valOnline = /*[[${pieOnline}]]*/ 0;

      var optionsDonut = {
        chart: { height: 320, type: "donut" },
        series: [valFisica, valOnline],
        labels: ["Tienda Física", "Tienda Online"],
        colors: ["#4680FF", "#E58A00"],
        legend: { position: "bottom" },
        plotOptions: {
          pie: {
            donut: {
              labels: {
                show: true,
                total: {
                  show: true,
                  label: "Total",
                  formatter: function (w) {
                    const total = w.globals.seriesTotals.reduce(
                      (a, b) => a + b,
                      0
                    );
                    return (
                      "S/ " +
                      total.toLocaleString("es-PE", {
                        minimumFractionDigits: 2,
                      })
                    );
                  },
                },
              },
            },
          },
        },
      };
      new ApexCharts(
        document.querySelector("#total-income-graph"),
        optionsDonut
      ).render();
    }, 500);
  });
</script>
