<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body th:fragment="scripts">

    <script src="/assets_shop/vendor/jquery/jquery.min.js"></script>
    <script src="/assets_shop/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/assets_shop/vendor/owl-carousel/owl.carousel.min.js"></script>
    <script src="/assets_shop/vendor/nouislider/nouislider.min.js"></script>
    <script src="/assets_shop/vendor/photoswipe/photoswipe.min.js"></script>
    <script src="/assets_shop/vendor/photoswipe/photoswipe-ui-default.min.js"></script>
    <script src="/assets_shop/vendor/select2/js/select2.min.js"></script>

    <script src="/assets_shop/js/number.js"></script>
    <script src="/assets_shop/js/main.js"></script>

    <script src="/assets_shop/js/cart.js"></script>

    <script>
document.addEventListener('click', function (e) {
    const btn = e.target.closest('.product-card__action--wishlist');
    if (!btn) return;

    const productId = btn.dataset.id;
    if (!productId) return;

    fetch('/api/favoritos/toggle?productoId=' + encodeURIComponent(productId), {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(resp => {
        if (!resp.ok) {
            if (resp.status === 401) {
                alert('Inicia sesiÃ³n para guardar favoritos.');
            } else {
                alert('No se pudo actualizar favoritos.');
            }
            throw new Error('HTTP ' + resp.status);
        }
        return resp.json();
    })
    .then(data => {
        if (data.favorito) {
            btn.classList.add('product-card__action--wishlist--active');
            btn.dataset.favorito = 'true';
        } else {
            btn.classList.remove('product-card__action--wishlist--active');
            btn.dataset.favorito = 'false';
        }
    })
    .catch(err => console.error(err));
});
</script>

</body>

</html>
